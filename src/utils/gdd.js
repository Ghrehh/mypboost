import Immutable from 'immutable';

const gdd = Immutable.fromJS({
    "Physical Health & Fitness": {
      "0": { "Male": 237, "Female": 234 },
      "6": { "Male": 412, "Female": 415 },
      "11": { "Male": 516, "Female": 522 },
      "16": { "Male": 644, "Female": 638 },
      "21": { "Male": 675, "Female": 667 },
      "26": { "Male": 663, "Female": 654 },
      "31": { "Male": 622, "Female": 611 },
      "36": { "Male": 597, "Female": 584 },
      "41": { "Male": 568, "Female": 557 },
      "46": { "Male": 541, "Female": 533 },
      "51": { "Male": 526, "Female": 519 },
      "56": { "Male": 513, "Female": 508 },
      "61": { "Male": 498, "Female": 495 },
      "66": { "Male": 481, "Female": 480 },
      "71": { "Male": 463, "Female": 464 },
      "76": { "Male": 442, "Female": 444 },
      "81": { "Male": 419, "Female": 422 },
      "86": { "Male": 397, "Female": 401 },
      "91": { "Male": 368, "Female": 373 }
    },
    "Mental Health & Wellbeing": {
      "0": { "Male": 186, "Female": 193 },
      "6": { "Male": 379, "Female": 385 },
      "11": { "Male": 428, "Female": 429 },
      "16": { "Male": 516, "Female": 514 },
      "21": { "Male": 592, "Female": 586 },
      "26": { "Male": 642, "Female": 639 },
      "31": { "Male": 685, "Female": 687 },
      "36": { "Male": 726, "Female": 732 },
      "41": { "Male": 768, "Female": 771 },
      "46": { "Male": 804, "Female": 805 },
      "51": { "Male": 832, "Female": 836 },
      "56": { "Male": 839, "Female": 845 },
      "61": { "Male": 836, "Female": 836 },
      "66": { "Male": 827, "Female": 829 },
      "71": { "Male": 804, "Female": 812 },
      "76": { "Male": 745, "Female": 756 },
      "81": { "Male": 687, "Female": 694 },
      "86": { "Male": 607, "Female": 622 },
      "91": { "Male": 516, "Female": 534 }
    },
    "Family & Friends": {
      "0": { "Male": 984, "Female": 991 },
      "6": { "Male": 868, "Female": 872 },
      "11": { "Male": 833, "Female": 839 },
      "16": { "Male": 612, "Female": 665 },
      "21": { "Male": 389, "Female": 684 },
      "26": { "Male": 559, "Female": 712 },
      "31": { "Male": 734, "Female": 748 },
      "36": { "Male": 745, "Female": 751 },
      "41": { "Male": 756, "Female": 763 },
      "46": { "Male": 767, "Female": 770 },
      "51": { "Male": 754, "Female": 760 },
      "56": { "Male": 743, "Female": 749 },
      "61": { "Male": 736, "Female": 738 },
      "66": { "Male": 762, "Female": 766 },
      "71": { "Male": 788, "Female": 788 },
      "76": { "Male": 729, "Female": 735 },
      "81": { "Male": 669, "Female": 685 },
      "86": { "Male": 609, "Female": 633 },
      "91": { "Male": 549, "Female": 588 }
    },
    "Career & Work/Life Balance": {
      "0": { "Male": 0, "Female": 0 },
      "6": { "Male": 0, "Female": 0 },
      "11": { "Male": 18, "Female": 12 },
      "16": { "Male": 36, "Female": 23 },
      "21": { "Male": 108, "Female": 70 },
      "26": { "Male": 324, "Female": 211 },
      "31": { "Male": 580, "Female": 377 },
      "36": { "Male": 740, "Female": 481 },
      "41": { "Male": 812, "Female": 528 },
      "46": { "Male": 848, "Female": 551 },
      "51": { "Male": 861, "Female": 560 },
      "56": { "Male": 888, "Female": 577 },
      "61": { "Male": 767, "Female": 499 },
      "66": { "Male": 639, "Female": 415 },
      "71": { "Male": 320, "Female": 208 },
      "76": { "Male": 158, "Female": 103 },
      "81": { "Male": 79, "Female": 51 },
      "86": { "Male": 40, "Female": 26 },
      "91": { "Male": 0, "Female": 0 }
    },
    "Wealth & Financial Wellbeing": {
      "0": { "Male": 0, "Female": 0 },
      "6": { "Male": 0, "Female": 0 },
      "11": { "Male": 14, "Female": 9 },
      "16": { "Male": 27, "Female": 18 },
      "21": { "Male": 81, "Female": 53 },
      "26": { "Male": 243, "Female": 158 },
      "31": { "Male": 435, "Female": 283 },
      "36": { "Male": 555, "Female": 361 },
      "41": { "Male": 609, "Female": 396 },
      "46": { "Male": 636, "Female": 413 },
      "51": { "Male": 646, "Female": 420 },
      "56": { "Male": 666, "Female": 433 },
      "61": { "Male": 575, "Female": 374 },
      "66": { "Male": 479, "Female": 312 },
      "71": { "Male": 240, "Female": 156 },
      "76": { "Male": 118, "Female": 77 },
      "81": { "Male": 59, "Female": 39 },
      "86": { "Male": 30, "Female": 19 },
      "91": { "Male": 16, "Female": 10 }
    },
    "Self Actualization": {
      "0": { "Male": 24, "Female": 24 },
      "6": { "Male": 42, "Female": 43 },
      "11": { "Male": 74, "Female": 75 },
      "16": { "Male": 129, "Female": 131 },
      "21": { "Male": 225, "Female": 230 },
      "26": { "Male": 394, "Female": 402 },
      "31": { "Male": 487, "Female": 497 },
      "36": { "Male": 584, "Female": 596 },
      "41": { "Male": 672, "Female": 685 },
      "46": { "Male": 739, "Female": 754 },
      "51": { "Male": 806, "Female": 822 },
      "56": { "Male": 870, "Female": 887 },
      "61": { "Male": 931, "Female": 950 },
      "66": { "Male": 922, "Female": 940 },
      "71": { "Male": 894, "Female": 912 },
      "76": { "Male": 850, "Female": 866 },
      "81": { "Male": 790, "Female": 806 },
      "86": { "Male": 719, "Female": 733 },
      "91": { "Male": 640, "Female": 653 }
    },
    "Overall Happiness": {
      "0": { "Male": 984, "Female": 991 },
      "6": { "Male": 868, "Female": 872 },
      "11": { "Male": 833, "Female": 839 },
      "16": { "Male": 612, "Female": 665 },
      "21": { "Male": 389, "Female": 684 },
      "26": { "Male": 559, "Female": 712 },
      "31": { "Male": 734, "Female": 748 },
      "36": { "Male": 745, "Female": 751 },
      "41": { "Male": 756, "Female": 763 },
      "46": { "Male": 767, "Female": 770 },
      "51": { "Male": 754, "Female": 760 },
      "56": { "Male": 743, "Female": 749 },
      "61": { "Male": 736, "Female": 738 },
      "66": { "Male": 762, "Female": 766 },
      "71": { "Male": 788, "Female": 788 },
      "76": { "Male": 729, "Female": 735 },
      "81": { "Male": 669, "Female": 685 },
      "86": { "Male": 609, "Female": 633 },
      "91": { "Male": 549, "Female": 588 }
    }
});

const parseAge = (state) => {
  const age = state.getIn(['fields', 'age', 'value']);
  const intAge = parseInt(age);
  if (String(intAge) !== age || intAge > 90 || 0 > intAge) return 91;

  const remainder = age % 5;
  let closestAge = remainder > 3 ? intAge + (5 - remainder) : intAge - remainder;
  if (closestAge !== 0) closestAge += 1; //everything but 0 ends in 6 or 1

  return closestAge;
};

const parseSex = (state) => {
  const sex = state.getIn(['fields', 'sex', 'value']);
  if (sex !== "Male" && sex !== "Female") return "Female";
  return sex;
};

export const getOverallGdd = (state) => {
  const age = parseAge(state);
  const sex = parseSex(state);

  const averageScore = gdd.reduce((reduction, value, key) => {
    if (key === "Overall Happiness") return reduction;
    if (Immutable.Map.isMap(reduction)) reduction = reduction.getIn([String(age), sex]);
    return reduction + value.getIn([String(age), sex]);
  }) / (gdd.size - 1);

  const happinessValue = gdd.getIn(["Overall Happiness", String(age), sex]);

  return Math.round((averageScore + (happinessValue * 2)) / 3);
};

export const getGddValues = (state) => {
  const age = parseAge(state);
  const sex = parseSex(state);

  return gdd.reduce((reduction, value, key) => {
    return reduction.set(key, value.getIn([String(age), sex]));
  }, Immutable.Map());
};

